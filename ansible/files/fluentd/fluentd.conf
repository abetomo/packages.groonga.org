<source>
  type debug_agent
  bind 127.0.0.1
  port 24230
</source>

<source>
  type tail
  path /var/log/apache2/access.log
  pos_file /var/log/td-agent/apache2_access.pos
  tag apache.raw.log.www.access
  format apache2
</source>

<match apache.**>
  type record_reformer
  enable_ruby false

  tag ${tag_suffix[1]}

  <record>
    remote ${host}
  </record>
</match>

<match raw.log.**>
  type record_reformer
  enable_ruby false

  tag ${tag_suffix[1]}

  <record>
    host ${hostname}
    type ${tag_parts[2]}
  </record>
</match>

<match log.**>
  type groonga
  table Logs

  protocol http
  host 127.0.1.1

  buffer_type file
  buffer_path /var/spool/td-agent/buffer/groonga
  flush_interval 1
</match>
